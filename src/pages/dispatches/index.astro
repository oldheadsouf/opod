---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Query all dispatches
const dispatches = await getCollection('dispatches');

// Sort by date (most recent first)
const sortedDispatches = dispatches
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Format date helper
const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};
---

<BaseLayout
  title="Temporal Dispatches - OPOD"
  description="Field notes from the edges of cultural consciousness. Tracking drift, decay, and pattern recognition in real-time."
>
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16 lg:py-20">

    <!-- Page Header -->
    <header class="mb-12 sm:mb-16">
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-4 leading-tight">
        Temporal Dispatches
      </h1>
      <p class="text-base sm:text-lg text-mist max-w-3xl">
        Field notes from the edges of cultural consciousness. Tracking drift, decay, and pattern recognition in real-time.
      </p>
    </header>

    <!-- Dispatches List -->
    <section>
      {sortedDispatches.length === 0 ? (
        <div class="bg-void border border-slate p-8">
          <p class="text-mist">No dispatches available at this time.</p>
        </div>
      ) : (
        <div class="space-y-6">
          {sortedDispatches.map((dispatch) => (
            <article class="bg-void border border-slate p-6 sm:p-8 hover:border-cyan-dim transition-colors">
              <a href={`/dispatches/${dispatch.slug}`} class="group">
                <h2 class="text-xl sm:text-2xl font-bold text-white mb-3 group-hover:text-cyan transition-colors">
                  {dispatch.data.title}
                </h2>
                <p class="text-sm text-cyan-dim mb-4 uppercase tracking-wider">
                  {formatDate(dispatch.data.date)}
                </p>
                <p class="text-base text-mist leading-relaxed mb-4">
                  {dispatch.data.description}
                </p>
                {dispatch.data.tags && dispatch.data.tags.length > 0 && (
                  <div class="flex flex-wrap gap-2">
                    {dispatch.data.tags.map((tag) => (
                      <span class="text-xs text-fog bg-slate px-2 py-1 border border-slate">
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
              </a>
            </article>
          ))}
        </div>
      )}
    </section>

  </div>
</BaseLayout>
